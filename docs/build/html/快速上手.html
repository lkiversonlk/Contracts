<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>快速上手 &mdash; 星火链开发者手册 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="星火链开发基础" href="%E6%98%9F%E7%81%AB%E9%93%BE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80.html" />
    <link rel="prev" title="概述" href="%E6%A6%82%E8%BF%B0.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> 星火链开发者手册
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">星火链应用开发手册:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="%E6%A6%82%E8%BF%B0.html">概述</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">快速上手</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sdk">SDK下载</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">账号创建</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">获取星火令</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">初始化SDK</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">查看账户状态</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">合约部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">合约调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">查询合约</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id9">接下来</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80.html">星火链开发基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESDK.html">星火链SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BEJavascript%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Javascript合约开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESolidity%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Solidity合约开发</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">星火链开发者手册</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>快速上手</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/快速上手.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>快速上手<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<p>以Java SDK为例, 在星火链测试网上部署, 调用, 查询一个Javascript智能合约.</p>
<section id="sdk">
<h2>SDK下载<a class="headerlink" href="#sdk" title="Permalink to this headline"></a></h2>
<p>请到<a class="reference external" href="https://github.com/CAICT-DEV/BIF-Core-SDK">https://github.com/CAICT-DEV/BIF-Core-SDK</a>下载java版本的SDK.</p>
</section>
<section id="id2">
<h2>账号创建<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p>调用JavaSDK接口离线创建一个账户.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cn.bif.model.crypto.KeyPairEntity</span><span class="p">;</span>
<span class="n">entity</span> <span class="o">=</span> <span class="n">KeyPairEntity</span><span class="p">.</span><span class="na">getBidAndKeyPair</span><span class="p">();</span>                             <span class="c1">//离线创建一个新账号</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;public BID %s\n&quot;</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="na">getEncAddress</span><span class="p">());</span>          <span class="c1">//账户地址, 可以公开</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;private key %s\n&quot;</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="na">getEncPrivateKey</span><span class="p">());</span>      <span class="c1">//账户私钥, 请妥善保管</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>获取星火令<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<p>账户需要拥有星火令才能正常使用星火链功能, 测试网星火令可以通过 <strong>待定</strong> 获取.</p>
</section>
<section id="id4">
<h2>初始化SDK<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h2>
<p>通过配置星火链RPC地址连接SDK到星火链, 本次demo里链接到星火链测试网.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cn.bif.api.BIFSDK</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NODE_URL</span> <span class="o">=</span> <span class="s">&quot;http://test-bif-core.xinghuo.space&quot;</span><span class="p">;</span>  <span class="c1">//星火链测试网RPC地址</span>

<span class="kd">public</span> <span class="n">staitc</span> <span class="n">BIFSDK</span> <span class="n">sdk</span> <span class="o">=</span> <span class="n">BIFSDK</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">NODE_URL</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>查看账户状态<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h2>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//构建查看账户请求</span>
<span class="n">BIFAccountGetInfoRequest</span> <span class="n">infoReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFAccountGetInfoRequest</span><span class="p">();</span>
<span class="c1">//要查看账户的地址</span>
<span class="n">infoReq</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>

<span class="c1">//发出查询请求</span>
<span class="n">BIFAccountGetInfoResponse</span> <span class="n">infoRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFAccountService</span><span class="p">().</span><span class="na">getAccount</span><span class="p">(</span><span class="n">infoReq</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//查询成功</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//查询失败</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>注意, 新创建的空白账户查询会失败, 需要转入星火令激活才能正常使用.</em></p>
<p>正常账户查询返回示例:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
    &quot;address&quot;:&quot;did:bid:efKkF5uKsopAishxkYja4ULRJhrhrJQU&quot;,    //账户地址
    &quot;balance&quot;:10000000000,                                   //账户余额
    &quot;nonce&quot;:0                                                //账户发出的交易计数
}
</pre></div>
</div>
</section>
<section id="id6">
<h2>合约部署<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Javascript智能合约代码</p>
<p>本次demo用的示例Javascript智能合约代码如下</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">queryById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>                        <span class="c1">//合约内部函数</span>
    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                         <span class="c1">//合约查询入口</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">queryById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                          <span class="c1">//合约调用入口</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="nx">Chain</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                          <span class="c1">//初始化函数</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>该合约实现了一个简单的存储功能, 用户可以调用main接口存储自定义Key-Value信息, 然后通过query接口查询已经存入的Key-Value信息.</p>
</li>
<li><p>部署合约</p>
<p>合约编写完毕后, 需要将合约部署到链上, <strong>注意这里需要账户内有足够的XHT</strong>, 部署代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//部署合约</span>

<span class="c1">//合约代码，注意转义</span>
<span class="n">String</span> <span class="n">contractCode</span> <span class="o">=</span> <span class="s">&quot;\&quot;use strict\&quot;;function queryById(id) {    let data = Chain.load(id);    return data;}function query(input) {    input = JSON.parse(input);    let id = input.id;    let object = queryById(id);    return object;}function main(input) {    input = JSON.parse(input);    Chain.store(input.id, input.data);}function init(input) {    return;}&quot;</span><span class="p">;</span>

<span class="n">BIFContractCreateRequest</span> <span class="n">createCReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractCreateRequest</span><span class="p">();</span>

<span class="c1">//创建方地址和私钥</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">privateKey</span><span class="p">);</span>

<span class="c1">//合约初始balance，一般为0</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setInitBalance</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>

<span class="c1">//合约代码</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">contractCode</span><span class="p">);</span>

<span class="c1">//标记和type，javascript合约type为0</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setRemarks</span><span class="p">(</span><span class="s">&quot;create contract&quot;</span><span class="p">);</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">//交易耗费上限</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setFeeLimit</span><span class="p">(</span><span class="mi">300000000L</span><span class="p">);</span>

<span class="c1">//调用SDK创建该合约</span>
<span class="n">BIFContractCreateResponse</span> <span class="n">createCRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractCreate</span><span class="p">(</span><span class="n">createCReq</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果部署成功, 调用返回里会拿到这个交易的HASH.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="s2">&quot;b25567a482e674d79ac5f9b5f6601f27b676dde90a6a56539053ec882a99854f&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>交易信息和合约地址查询</p>
<p>用SDK查询部署合约的交易详细信息, 可以从中获取到创建的合约地址.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BIFContractGetAddressRequest</span> <span class="n">cAddrReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractGetAddressRequest</span><span class="p">();</span>
<span class="n">cAddrReq</span><span class="p">.</span><span class="na">setHash</span><span class="p">(</span><span class="n">cTxHash</span><span class="p">);</span>

<span class="n">BIFContractGetAddressResponse</span> <span class="n">cAddrRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">getContractAddress</span><span class="p">(</span><span class="n">cAddrReq</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>合约部署信息示例如下:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;contract_address_infos&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;contract_address&quot;</span><span class="p">:</span><span class="s2">&quot;did:bid:efSvDJivc2A4iqurRkUPzmpT5kB3nkNg&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;operation_index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>did:bid:efSvDJivc2A4iqurRkUPzmpT5kB3nkNg即为刚刚创建的合约链上地址.</p>
</li>
</ul>
</section>
<section id="id7">
<h2>合约调用<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h2>
<p>合约成功部署并且获取到合约地址后, 就可以通过SDK发送交易调用合约接口, 我们存储一个Key-Value对到合约里:</p>
<p>调用合约input如下</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>调用合约代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//转义后input</span>
<span class="n">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">&quot;{\&quot;id\&quot;:\&quot;test\&quot;, \&quot;data\&quot;: \&quot;test\&quot;}&quot;</span><span class="p">;</span>

<span class="n">BIFContractInvokeRequest</span> <span class="n">cIvkReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractInvokeRequest</span><span class="p">();</span>

<span class="c1">//调用者地址和私钥</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">privateKey</span><span class="p">);</span>

<span class="c1">//合约地址</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setContractAddress</span><span class="p">(</span><span class="n">cAddr</span><span class="p">);</span>

<span class="c1">//调用交易XHT金额</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setBIFAmount</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>

<span class="c1">//标记</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setRemarks</span><span class="p">(</span><span class="s">&quot;contract invoke&quot;</span><span class="p">);</span>

<span class="c1">//调用input</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setInput</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="n">BIFContractInvokeResponse</span> <span class="n">cIvkRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractInvoke</span><span class="p">(</span><span class="n">cIvkReq</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>调用成功后，我们会得到调用交易的HASH：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="s2">&quot;c79835265e908f7f06d4fc2c61ef3fd046ae5252675e4671271bd921ad8fde89&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id8">
<h2>查询合约<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h2>
<p>不同于调用合约, 查询合约为只读操作, 因此不需要发出上链交易和耗费gas, 这里我们查询刚刚设置的key, 查询input为:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Java查询代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BIFContractCallRequest</span> <span class="n">cCallReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractCallRequest</span><span class="p">();</span>             <span class="c1">//查询请求</span>

<span class="n">String</span> <span class="n">callInput</span> <span class="o">=</span> <span class="s">&quot;{\&quot;id\&quot;:\&quot;test\&quot;}&quot;</span><span class="p">;</span>                                     <span class="c1">//查询input</span>

<span class="n">cCallReq</span><span class="p">.</span><span class="na">setContractAddress</span><span class="p">(</span><span class="n">cAddr</span><span class="p">);</span>
<span class="n">cCallReq</span><span class="p">.</span><span class="na">setInput</span><span class="p">(</span><span class="n">callInput</span><span class="p">);</span>

<span class="n">BIFContractCallResponse</span> <span class="n">cCallRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractQuery</span><span class="p">(</span><span class="n">cCallReq</span><span class="p">);</span> <span class="c1">//查询</span>

<span class="k">if</span> <span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>查询的返回如下:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;query_rets&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id9">
<h2>接下来<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h2>
<p>至此我们就完成了一个链上javascript合约从部署到操作的全过程, 有关合约的更高阶开发和星火链体系模型, 请参见后续专栏.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="%E6%A6%82%E8%BF%B0.html" class="btn btn-neutral float-left" title="概述" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="%E6%98%9F%E7%81%AB%E9%93%BE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80.html" class="btn btn-neutral float-right" title="星火链开发基础" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, 中国信息通信研究院.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>