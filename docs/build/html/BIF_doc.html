<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>星火链开发文档 &mdash; 星火链开发者手册 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> 星火链开发者手册
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">星火链应用开发手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="%E6%A6%82%E8%BF%B0.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BE%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80.html">星火链开发基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESDK.html">星火链SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BEJavascript%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Javascript合约开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESolidity%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Solidity合约开发</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">星火链开发者手册</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>星火链开发文档</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/BIF_doc.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>星火链开发文档<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<section id="id2">
<h2>概述<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<section id="id3">
<h3>什么是星火链<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p>星火·链网-底层区块链平台(BIF-Core)，简称星火链，是中国信息通信研究院基于区块链技术打造的一条许可公有链，是实现“星火·链网”这一国家级区块链与工业互联网协同创新新型基础设施的关键技术.</p>
<ol class="arabic simple">
<li><p>星火链与联盟链的区别</p></li>
</ol>
<p>不同于联盟链,星火链的链上交易需要耗费星火令(XHT),</p>
<ol class="arabic simple">
<li><p>星火链与比特币,以太坊的区别</p></li>
</ol>
<p>星火链采取准入制</p>
</section>
<section id="id4">
<h3>星火链应用开发须知<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>星火令XHT</p>
<p>星火链是星火链的基础单位, 在星火链上发起的交易都需要耗费星火令.</p>
</li>
<li><p>星火链智能合约</p>
<p>智能合约指的是部署在区块链上自动执行的代码逻辑，开发者能够利用星火链支持的编程语言，开发一个商业级别的智能合约.</p>
<p>星火链智能合约存储在区块链中，分布在每一个节点上，用户通过交易去触发合约脚本的执行，并把执行的结果写入到区块链中，并通过底层共识功能保证所有数据的一致性.</p>
<p>目前星火链支持javascript, solidity两种语言的智能合约,C++智能合约支持正在研发中.</p>
</li>
<li><p>星火链SDK</p>
<p>星火链提供了基于多种语言的SDK https://github.com/CAICT-DEV/BIF-Core-SDK, 用来方便开发者程序与链上交互.SDK提供功能包括:</p>
<ul class="simple">
<li><p>创建账户</p></li>
<li><p>查询指定账户的信息</p></li>
<li><p>查询交易信息</p></li>
<li><p>部署合约</p></li>
<li><p>发出交易调用合约,以及查询合约</p></li>
</ul>
</li>
<li><p>星火链浏览器</p>
<p>星火链浏览器提供了对账户, 交易, 合约的查询和跟踪等功能, 可以节省开发者的大量时间和精力. 目前星火链测试网的浏览器地址为:</p>
<ul class="simple">
<li><p>主网</p></li>
<li><p>测试网: http://test-explorer.bitfactory.cn/</p></li>
</ul>
</li>
<li><p>星火链RPC地址</p>
<ul class="simple">
<li><p>主网:</p></li>
<li><p>测试网: http://test-bif-core.xinghuo.space</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="id5">
<h2>快速上手<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h2>
<p>接下来以Java SDK为例, 指导开发者在星火链测试网上部署, 调用和查询一个简单的智能合约.</p>
<ol class="arabic">
<li><p>账号创建</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cn.bif.model.crypto.KeyPairEntity</span><span class="p">;</span>

<span class="n">entity</span> <span class="o">=</span> <span class="n">KeyPairEntity</span><span class="p">.</span><span class="na">getBidAndKeyPair</span><span class="p">();</span>                             <span class="c1">//离线创建一个新账号</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;public BID %s\n&quot;</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="na">getEncAddress</span><span class="p">());</span>          <span class="c1">//账户地址, 可以公开</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">printf</span><span class="p">(</span><span class="s">&quot;private key %s\n&quot;</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="na">getEncPrivateKey</span><span class="p">());</span>      <span class="c1">//账户私钥, 请妥善保管</span>
</pre></div>
</div>
</li>
<li><p>获取星火令</p>
<p>测试网星火链可以通过**待定???**获取,</p>
</li>
<li><p>初始化星火链SDK</p>
<p>通过配置星火链RPC地址连接SDK到星火链.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cn.bif.api.BIFSDK</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NODE_URL</span> <span class="o">=</span> <span class="s">&quot;http://test-bif-core.xinghuo.space&quot;</span><span class="p">;</span>  <span class="c1">//星火链测试网RPC地址</span>

<span class="kd">public</span> <span class="n">staitc</span> <span class="n">BIFSDK</span> <span class="n">sdk</span> <span class="o">=</span> <span class="n">BIFSDK</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">NODE_URL</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>查看账户状态</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BIFAccountGetInfoRequest</span> <span class="n">infoReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFAccountGetInfoRequest</span><span class="p">();</span>
<span class="n">infoReq</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>                                        <span class="c1">//要查看账户的地址</span>

<span class="n">BIFAccountGetInfoResponse</span> <span class="n">infoRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFAccountService</span><span class="p">().</span><span class="na">getAccount</span><span class="p">(</span><span class="n">infoReq</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>  <span class="c1">//查询失败</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">infoRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>                       <span class="c1">//</span>
<span class="p">}</span>
</pre></div>
</div>
<p>注意, 新创建的账户查询会失败, 因为没有任何转入转出的交易记录. 成功获取星火令后, 查询账户状态返回应该是:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
    &quot;address&quot;:&quot;did:bid:efKkF5uKsopAishxkYja4ULRJhrhrJQU&quot;,    //账户地址
    &quot;balance&quot;:10000000000,                                   //账户余额
    &quot;nonce&quot;:0                                                //账户发出的交易计数
}
</pre></div>
</div>
</li>
<li><p>合约部署</p>
<ul>
<li><p>合约代码</p>
<p>合约开发资料可以参见高级话题部分,这里先用一个示例的javascript合约代码:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">queryById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>                        <span class="c1">//合约内部函数</span>
    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                         <span class="c1">//合约查询入口</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">queryById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">object</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                          <span class="c1">//合约调用入口</span>
    <span class="nx">input</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
    <span class="nx">Chain</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">input</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>                          <span class="c1">//初始化函数</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>该合约实现了一个简单的存储功能, 用户可以按照任意key存入和读取数据.</p>
</li>
<li><p>合约部署</p>
<p>合约编写完毕后, 需要将合约部署到链上, <strong>注意这里需要账户内有足够的XHT</strong>, 部署示例代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//部署合约</span>

<span class="c1">//合约代码，注意转义</span>
<span class="n">String</span> <span class="n">contractCode</span> <span class="o">=</span> <span class="s">&quot;\&quot;use strict\&quot;;function queryById(id) {    let data = Chain.load(id);    return data;}function query(input) {    input = JSON.parse(input);    let id = input.id;    let object = queryById(id);    return object;}function main(input) {    input = JSON.parse(input);    Chain.store(input.id, input.data);}function init(input) {    return;}&quot;</span><span class="p">;</span>

<span class="n">BIFContractCreateRequest</span> <span class="n">createCReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractCreateRequest</span><span class="p">();</span>

<span class="c1">//创建方地址和私钥</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">privateKey</span><span class="p">);</span>

<span class="c1">//合约初始balance，一般为0</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setInitBalance</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>

<span class="c1">//合约代码</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">contractCode</span><span class="p">);</span>

<span class="c1">//标记和type，javascript合约type为0</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setRemarks</span><span class="p">(</span><span class="s">&quot;create contract&quot;</span><span class="p">);</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">//交易耗费上限</span>
<span class="n">createCReq</span><span class="p">.</span><span class="na">setFeeLimit</span><span class="p">(</span><span class="mi">300000000L</span><span class="p">);</span>

<span class="c1">//调用SDK创建该合约</span>
<span class="n">BIFContractCreateResponse</span> <span class="n">createCRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractCreate</span><span class="p">(</span><span class="n">createCReq</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">createCRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果部署成功, 调用返回里会拿到这个交易的HASH.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="s2">&quot;b25567a482e674d79ac5f9b5f6601f27b676dde90a6a56539053ec882a99854f&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>交易信息和合约地址查询</p>
<p>用SDK查询交易详细信息, 并且可以从中获取到刚创建的合约地址.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BIFContractGetAddressRequest</span> <span class="n">cAddrReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractGetAddressRequest</span><span class="p">();</span>
<span class="n">cAddrReq</span><span class="p">.</span><span class="na">setHash</span><span class="p">(</span><span class="n">cTxHash</span><span class="p">);</span>

<span class="n">BIFContractGetAddressResponse</span> <span class="n">cAddrRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">getContractAddress</span><span class="p">(</span><span class="n">cAddrReq</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cAddrRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;contract_address_infos&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;contract_address&quot;</span><span class="p">:</span><span class="s2">&quot;did:bid:efSvDJivc2A4iqurRkUPzmpT5kB3nkNg&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;operation_index&quot;</span><span class="p">:</span><span class="mi">0</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>合约调用</p>
<p>合约成功部署并且获取到地址后, 就可以调用合约的main函数, 这里我们存储一个值到合约里:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>合约调用的代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//转义后input</span>
<span class="n">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">&quot;{\&quot;id\&quot;:\&quot;test\&quot;, \&quot;data\&quot;: \&quot;test\&quot;}&quot;</span><span class="p">;</span>

<span class="n">BIFContractInvokeRequest</span> <span class="n">cIvkReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractInvokeRequest</span><span class="p">();</span>

<span class="c1">//调用者地址和私钥</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">);</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">privateKey</span><span class="p">);</span>

<span class="c1">//合约地址</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setContractAddress</span><span class="p">(</span><span class="n">cAddr</span><span class="p">);</span>

<span class="c1">//调用交易XHT金额</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setBIFAmount</span><span class="p">(</span><span class="mi">0</span><span class="n">L</span><span class="p">);</span>

<span class="c1">//标记</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setRemarks</span><span class="p">(</span><span class="s">&quot;contract invoke&quot;</span><span class="p">);</span>

<span class="c1">//调用input</span>
<span class="n">cIvkReq</span><span class="p">.</span><span class="na">setInput</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>

<span class="n">BIFContractInvokeResponse</span> <span class="n">cIvkRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractInvoke</span><span class="p">(</span><span class="n">cIvkReq</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cIvkRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>调用成功后，我们会得到调用交易的HASH：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;hash&quot;</span><span class="p">:</span><span class="s2">&quot;c79835265e908f7f06d4fc2c61ef3fd046ae5252675e4671271bd921ad8fde89&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>查询合约</p>
<p>不同于调用合约, 查询合约为只读操作, 因此不需要发出上链交易和耗费gas, 这里我们查询刚刚设置的key, 查询input为:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Java查询代码如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BIFContractCallRequest</span> <span class="n">cCallReq</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractCallRequest</span><span class="p">();</span>             <span class="c1">//查询请求</span>

<span class="n">String</span> <span class="n">callInput</span> <span class="o">=</span> <span class="s">&quot;{\&quot;id\&quot;:\&quot;test\&quot;}&quot;</span><span class="p">;</span>                                     <span class="c1">//查询input</span>

<span class="n">cCallReq</span><span class="p">.</span><span class="na">setContractAddress</span><span class="p">(</span><span class="n">cAddr</span><span class="p">);</span>
<span class="n">cCallReq</span><span class="p">.</span><span class="na">setInput</span><span class="p">(</span><span class="n">callInput</span><span class="p">);</span>

<span class="n">BIFContractCallResponse</span> <span class="n">cCallRsp</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractQuery</span><span class="p">(</span><span class="n">cCallReq</span><span class="p">);</span> <span class="c1">//查询</span>

<span class="k">if</span> <span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JsonUtils</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getResult</span><span class="p">()));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cCallRsp</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>查询的返回如下:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;query_rets&quot;</span><span class="p">:[</span><span class="w"></span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="p">{</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;test&quot;</span><span class="w"></span>
<span class="w">                </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
</ol>
<p>至此我们就完成了一个链上javascript合约从部署到操作的全过程, 有关合约的更高阶开发和星火链体系模型, 请参见高级话题</p>
</section>
<section id="id6">
<h2>高级话题<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h2>
<section id="id7">
<h3>帐号<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<p>星火链帐号的定义如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span> <span class="n">Account</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="n">address</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">int64</span>  <span class="n">nonce</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">AccountPrivilege</span> <span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nb">bytes</span> <span class="n">metadatas_hash</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nb">bytes</span> <span class="n">assets_hash</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">Contract</span> <span class="n">contract</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">int64</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>这里对其中几个主要项的解释如下:</p>
<ol class="arabic">
<li><p>address</p>
<p>账户地址</p>
</li>
<li><p>nonce</p>
<p>从0开始的数字, 代表该账户发起过的交易数量, 同时用来防止签名重放攻击, 每当该账号执行一笔交易后，该账号的序号就会加1，无论该交易成功还是失败.当你用一个账号发起交易时，要在该交易中指定一个nonce值，交易中的这个nonce值必须比当前账号的nonce大1, 当一个账号被新建时，它的nonce为0.</p>
</li>
<li><p>contract</p>
<p>如果该字段不为空, 则该账户为合约账户.</p>
</li>
<li><p>balance</p>
<p>账户余额, 注意:每个账户至少要保留0.1XHT余额.</p>
</li>
</ol>
</section>
<section id="id8">
<h3>交易<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<p>星火链上的交易包含的主要元素如下:</p>
<ol class="arabic">
<li><p>source</p>
<p>交易发出地址, 由该地址来支付本次交易耗费的星火令.</p>
</li>
<li><p>nonce</p>
<p>交易序号, 同一个source下的所有交易必须具有唯一的nonce序号, 并且交易只能按照nonce从小到大按序入链, 中间不能有空.</p>
</li>
<li><p>fee_limit</p>
<p>该交易的费用上限, 防止因为不可预知原因或者bug,导致交易耗费过多超出预期. 当一个交易花费超过fee_limit时, 交易失败, 但是耗费的fee不会返还.</p>
</li>
<li><p>gas_price</p>
<p>交易的gas价格, 详细参见<strong>费用</strong>章节</p>
</li>
</ol>
</section>
<section id="id9">
<h3>交易耗费计算和检查<a class="headerlink" href="#id9" title="Permalink to this headline"></a></h3>
<p>星火链上的所有交易都需要耗费XHT, 耗费的计算公式为gas * gas_price.</p>
<ol class="arabic">
<li><p>gas</p>
<p>gas用来表示单个交易的计算成本, 对于javascript合约, 每种交易类型的gas耗费固定, 对于solidity合约, 交易gas耗费是实际执行的各个op(操作码)的gas耗费之和.</p>
</li>
<li><p>gas_price</p>
<p>gas_price指用户愿意为每单位gas支付的XHT数量, 由用户自己在发出交易时指定.</p>
</li>
</ol>
<p>星火链上每个区块的交易打包时, 会根据gas_price价格排序, gas_price越高的交易会排在前面优先执行. 同时每笔交易在打包前, 会检查下账户费用是否满足以下条件</p>
<ol class="arabic simple">
<li><p>账户balance - 账户最低reserve_balance &gt; fee_limit</p></li>
<li><p>账户balance - 账户最低reserve_balance &gt; gas * gas_price, 注意这里对于javascript合约, 如果该条件不满足, 交易直接不予入链. 但对于EVM合约, 会实时消耗XHT到余额不足时交易失败, 耗费的fee不会返还.</p></li>
</ol>
</section>
<section id="javascript">
<h3>Javascript合约开发<a class="headerlink" href="#javascript" title="Permalink to this headline"></a></h3>
<ol class="arabic">
<li><p>星火链Javascript智能合约规范</p>
<p>JavaScript智能合约是一段 JavaScript 代码，标准(ECMAScript as specified in ECMA-262)，使用Spark-V8引擎。</p>
<p>合约结构分为如下三段。合约上链部署完成后，合约文本会直接存储到合约账户结构中。</p>
<p>合约的初始化函数是 <code class="docutils literal notranslate"><span class="pre">init</span></code>, 合约部署时自动由虚拟机引擎直接调用init进行合约账户数据的初始化。</p>
<p>合约执行的入口函数是 <code class="docutils literal notranslate"><span class="pre">main</span></code>函数，main中可实现不同的功能接口，并通过参数字符串input选择不同接口。main函数入口仅支持合约调用者以<strong>星火交易</strong>方式进行调用，内部功能接口可实现合约数据存储相关操作。（可实现读写功能）</p>
<p>合约查询接口是 <code class="docutils literal notranslate"><span class="pre">query</span></code>函数，query中可实现不同的查询功能接口，并通过参数字符串input选择不同接口。query函数入口仅支持合约调用者以<strong>查询接口</strong>进行调用，内部功能接口可用于合约账户中数据的读取，禁止进行合约数据存储相关操作。调用过程不需消耗星火令。(只读功能)</p>
<p>下面是一个简单的例子：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
<span class="cm">/*init whatever you want*/</span>
<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
<span class="kd">let</span> <span class="nx">para</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">para</span><span class="p">.</span><span class="nx">do_foo</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;hello&#39;</span> <span class="o">:</span> <span class="s1">&#39;world&#39;</span>
    <span class="p">};</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span> 
<span class="k">return</span> <span class="nx">input</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>除此之外, 星火链javascript合约对javascript语法也做了一些限定:</p>
<ul class="simple">
<li><p>源码开头必须添加 “use strict;”.</p></li>
<li><p>使用 === 和 !==, 禁用 == 和 != .</p></li>
<li><p>使用 +=, -=, 禁用 ++ 和 – .</p></li>
</ul>
</li>
<li><p>星火区块链 API</p>
<p>为星火链JavaScript智能合约的高效执行，星火链实现了部分预编译JavaScript指令，可通过智能合约直接进行调用。</p>
<p>智能合约内提供了全局对象 <code class="docutils literal notranslate"><span class="pre">Chain</span></code> 和 <code class="docutils literal notranslate"><span class="pre">Utils</span></code>, 这两个对象提供了多样的方法和变量，可以获取区块链的一些信息，也可驱动账号发起交易。</p>
<ul>
<li><p>Chain对象方法列表</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>方法</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Chain.load(metadata_key)</p></td>
<td><p>获取合约账号的metadata信息</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.store(metadata_key, metadata_value)</p></td>
<td><p>存储合约账号的metadata信息</p></td>
</tr>
<tr class="row-even"><td><p>Chain.del(metadata_key)</p></td>
<td><p>删除合约账号的metadata信息</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.getBlockHash(offset_seq)</p></td>
<td><p>获取区块信息</p></td>
</tr>
<tr class="row-even"><td><p>Chain.tlog(topic,args…)</p></td>
<td><p>输出交易日志</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.getAccountMetadata(account_address, metadata_key)</p></td>
<td><p>获取指定账号的metadata信息</p></td>
</tr>
<tr class="row-even"><td><p>Chain.getBalance(address)</p></td>
<td><p>获取账号coin amount</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.getAccountPrivilege(account_address)</p></td>
<td><p>获取某个账号的权限信息</p></td>
</tr>
<tr class="row-even"><td><p>Chain.getContractProperty(contract_address)</p></td>
<td><p>获取合约账号属性</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.payCoin(address, amount[, input], [, metadata])</p></td>
<td><p>转账</p></td>
</tr>
<tr class="row-even"><td><p>Chain.delegateCall(contractAddress, input)</p></td>
<td><p>委托调用</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.delegateQuery(contractAddress, input)</p></td>
<td><p>委托查询</p></td>
</tr>
<tr class="row-even"><td><p>Chain.contractCall(contractAddress, asset, amount, input)</p></td>
<td><p>调用合约</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<ul>
<li><p>Chain对象方法详细说明</p>
<ul class="simple">
<li><p>获取合约账号的metadata信息</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.load(metadata_key);</span></code></p>
<p>即可得到本合约账号中自定数据的abc的值。</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>metadata_key</p></td>
<td><p>metadata的key</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：成功返回字符串，如 &#39;values&#39;, 失败返回false</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>存储合约账号的metadata信息</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.store(metadata_key,</span> <span class="pre">metadata_value);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>metadata_key</p></td>
<td><p>metadata的key</p></td>
</tr>
<tr class="row-odd"><td><p>metadata_value</p></td>
<td><p>metadata 的 value</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Chain</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：可写</span>
<span class="cm">    返回：成功返回true, 失败抛异常</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>删除合约账号的metadata信息</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.del(metadata_key);</span></code></p>
<p>即可删除本合约账号中自定数据的abc的值。</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>metadata_key</p></td>
<td><p>metadata的key</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Chain</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：可写</span>
<span class="cm">    返回：成功返回true, 失败抛异常</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取区块信息</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.getBlockHash(offset_seq);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>offset_seq</p></td>
<td><p>距离最后一个区块的偏移量，范围：[0,1024)</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">ledger</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">getBlockHash</span><span class="p">(</span><span class="mf">4</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：成功返回字符串，如 &#39;c2f6892eb934d56076a49f8b01aeb3f635df3d51aaed04ca521da3494451afb3&#39;，失败返回 false</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>输出交易日志</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tlog(topic,args...);</span></code></p>
<p>tlog会产生一笔交易写在区块上。</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>topic</p></td>
<td><p>日志主题，必须为字符串类型,参数长度(0,128]</p></td>
</tr>
<tr class="row-odd"><td><p>args…</p></td>
<td><p>最多可以包含5个参数，参数类型可以是字符串、数值或者布尔类型,每个参数长度(0,1024]</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Chain</span><span class="p">.</span><span class="nx">tlog</span><span class="p">(</span><span class="s1">&#39;transfer&#39;</span><span class="p">,</span><span class="nx">sender</span> <span class="o">+</span><span class="s1">&#39; transfer 1000&#39;</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：可写</span>
<span class="cm">    返回：成功返回 true，失败抛异常</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取指定账号的metadata</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.getAccountMetadata(account_address,</span> <span class="pre">metadata_key);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>account_address</p></td>
<td><p>账号地址</p></td>
</tr>
<tr class="row-odd"><td><p>metadata_key</p></td>
<td><p>metadata的key</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">getAccountMetadata</span><span class="p">(</span><span class="s1">&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：成功返回字符串，如 &#39;values&#39;, 失败返回false</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取账号coin amount</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.getBalance(address);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>address</p></td>
<td><p>账号地址</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">balance</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">getBalance</span><span class="p">(</span><span class="s1">&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：字符串格式数字 &#39;9999111100000&#39;</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取某个账号的权限信息</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.getAccountPrivilege(account_address);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>account_address</p></td>
<td><p>账号地址</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">privilege</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">getAccountPrivilege</span><span class="p">(</span><span class="s1">&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：成功返回权限json字符串如&#39;{&quot;master_weight&quot;:1,&quot;thresholds&quot;:{&quot;tx_threshold&quot;:1}}&#39;，失败返回 falses</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取合约账号属性</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.getContractProperty(contract_address);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>contract_address</p></td>
<td><p>合约地址</p></td>
</tr>
</tbody>
</table>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">getContractProperty</span><span class="p">(</span><span class="s1">&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    权限：只读</span>
<span class="cm">    返回：成功返回JSON对象，如 {&quot;type&quot;:0, &quot;length&quot; : 416},  type 指合约类型， length 指合约代码长度，如果该账户不是合约则，length 为0.</span>
<span class="cm">    失败返回false</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>转账</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.payCoin(address,</span> <span class="pre">amount[,</span> <span class="pre">input],</span> <span class="pre">[,</span> <span class="pre">metadata]);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>address</p></td>
<td><p>发送星火令的目标地址</p></td>
</tr>
<tr class="row-odd"><td><p>amount</p></td>
<td><p>发送星火令的数量</p></td>
</tr>
<tr class="row-even"><td><p>input</p></td>
<td><p>可选，合约参数，如果用户未填入，默认为空字符串</p></td>
</tr>
<tr class="row-odd"><td><p>metadata</p></td>
<td><p>可选，转账备注，显示为十六进制字符串，需要转换为明文</p></td>
</tr>
</tbody>
</table>
<p>​		注意，如果提供metadata参数，那么也必须提供input参数，否则内置接口无法区分该参数是谁，因为两者都是可选的。如果没有input，可以传入空字符串**””**占位,以防止内置接口将metadata参数误认为inut参数。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">Chain</span><span class="p">.</span><span class="nx">payCoin</span><span class="p">(</span><span class="s2">&quot;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&quot;</span><span class="p">,</span> <span class="s2">&quot;10000&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;vote reward&quot;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：可写</span>
<span class="cm">    返回：成功返回 true，失败抛异常  </span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>委托调用</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.delegateCall(contractAddress,</span> <span class="pre">input);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>contractAddress</p></td>
<td><p>被调用的合约地址</p></td>
</tr>
<tr class="row-odd"><td><p>input</p></td>
<td><p>调用参数</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">Chain.delegateCall</span></code> 函数会触发被调用的合约<code class="docutils literal notranslate"><span class="pre">main</span></code>函数入口，并且把当前合约的执行环境赋予被调用的合约。如合约A委托调用合约B，即执行B(main入口)的代码，读写A的数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>let ret = Chain.delegateCall(&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;，&#39;{}&#39;);
/*
    权限：可写
    返回：成功会返回被委托者合约main函数执行的结果，失败抛出异常
*/

</pre></div>
</div>
<ul class="simple">
<li><p>委托查询</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.delegateQuery(contractAddress,</span> <span class="pre">input);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>contractAddress</p></td>
<td><p>被调用的合约地址</p></td>
</tr>
<tr class="row-odd"><td><p>input</p></td>
<td><p>调用参数</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">Chain.delegateQuery</span></code> 函数会触发被调用的合约<code class="docutils literal notranslate"><span class="pre">query</span></code>函数入口，且把当前合约的执行环境赋予被调用的合约。如合约A委托查询合约B，即执行B(query入口)的代码，读取A的数据。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>let ret = Chain.delegateQuery(&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;，&quot;&quot;);
/*
    权限：只读
    返回：调用成功则返回JSON对象 {&quot;result&quot;:&quot;4&quot;}，其中 result 字段的值即查询的具体结果，调用失败返回JSON对象 {&quot;error&quot;:true} 。
*/

</pre></div>
</div>
<ul class="simple">
<li><p>调用合约</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractCall(contractAddress,</span> <span class="pre">asset,</span> <span class="pre">amount,</span> <span class="pre">input);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>contractAddress</p></td>
<td><p>被调用的合约地址</p></td>
</tr>
<tr class="row-odd"><td><p>asset</p></td>
<td><p>仅支持传入true，代表星火令</p></td>
</tr>
<tr class="row-even"><td><p>amount</p></td>
<td><p>星火令数量</p></td>
</tr>
<tr class="row-odd"><td><p>input</p></td>
<td><p>调用参数</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractCall</span></code> 函数会触发被调用的合约<code class="docutils literal notranslate"><span class="pre">main</span></code>函数入口。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>let ret = Chain.contractCall(&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;，true, toBaseUnit(&quot;10&quot;), &quot;&quot;);
/*
    权限：可写
    返回：如果目标账户为普通账户，则返回true，如果目标账户为合约，成功会返回被委托者合约main函数执行的结果，调用失败则抛出异常
*/

</pre></div>
</div>
<ul class="simple">
<li><p>查询合约</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractQuery(contractAddress,</span> <span class="pre">input);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>contractAddress</p></td>
<td><p>被调用的合约地址</p></td>
</tr>
<tr class="row-odd"><td><p>input</p></td>
<td><p>调用参数</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractQuery</span></code> 会调用合约的查询接口。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>let ret = Chain.contractQuery(&#39;did:bid:efAsXt5zM2Hsq6wCYRMZBS5Q9HvG2EmK&#39;，&quot;&quot;);
/*
    权限：只读
    返回：调用成功则返回JSON对象 {&quot;result&quot;:&quot;xxx&quot;}，其中 result 字段的值即查询的具体结果，调用失败返回JSON对象 {&quot;error&quot;:true}。
*/

</pre></div>
</div>
<ul class="simple">
<li><p>创建合约</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractCreate(balance,</span> <span class="pre">type,</span> <span class="pre">code,</span> <span class="pre">input);</span></code></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>balance</p></td>
<td><p>字符串类型，转移给被创建的合约的星火令</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>整型，0代表javascript</p></td>
</tr>
<tr class="row-even"><td><p>code</p></td>
<td><p>字符串类型， 合约代码</p></td>
</tr>
<tr class="row-odd"><td><p>input：init</p></td>
<td><p>init函数初始化参数</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">Chain.contractCreate</span></code> 创建合约。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">contractCreate</span><span class="p">(</span><span class="nx">toBaseUnit</span><span class="p">(</span><span class="s2">&quot;10&quot;</span><span class="p">),</span> <span class="mf">0</span><span class="p">,</span> <span class="s2">&quot;&#39;use strict&#39;;function init(input){return input;} function main(input){return input;} function query(input){return input;} &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">    权限：可写</span>
<span class="cm">    返回：创建成功返回合约地址字符串，失败则抛出异常</span>
<span class="cm">*/</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变量</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Chain.block.timestamp</p></td>
<td><p>当前区块的时间戳</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.block.number</p></td>
<td><p>当前区块高度</p></td>
</tr>
<tr class="row-even"><td><p>Chain.tx.initiator</p></td>
<td><p>交易的发起者</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.tx.sender</p></td>
<td><p>交易的触发者</p></td>
</tr>
<tr class="row-even"><td><p>Chain.tx.gasPrice</p></td>
<td><p>交易的星火令价格</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.tx.hash</p></td>
<td><p>交易hash值</p></td>
</tr>
<tr class="row-even"><td><p>Chain.tx.feeLimit</p></td>
<td><p>交易的限制费用</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.msg.initiator</p></td>
<td><p>消息的发起者</p></td>
</tr>
<tr class="row-even"><td><p>Chain.msg.sender</p></td>
<td><p>消息的触发者</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.msg.nonce</p></td>
<td><p>本次交易消息发起者的nonce值</p></td>
</tr>
<tr class="row-even"><td><p>Chain.msg.operationIndex</p></td>
<td><p>触发本次合约调用的操作的序号</p></td>
</tr>
<tr class="row-odd"><td><p>Chain.thisAddress</p></td>
<td><p>当前合约账号的地址</p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>区块信息 Chain.block</p>
<ul>
<li><p>当前区块时间戳</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.block.timestamp</span></code></p>
<p>当前交易执行时候所在的区块时间戳。</p>
</li>
<li><p>当前区块高度</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.block.number</span></code></p>
<p>当前交易执行时候所在的区块高度。</p>
</li>
</ul>
</li>
<li><p>交易 Chain.tx</p>
<p>交易是用户签名的那笔交易信息。</p>
<ul>
<li><p>交易的发起者</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tx.initiator</span></code></p>
<p>交易最原始的发起者，即交易的费用付款者。</p>
</li>
<li><p>交易的触发者</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tx.sender</span></code></p>
<p>交易最原始的触发者，即交易里触发合约执行的操作的账户。
例如某账号发起了一笔交易，该交易中有个操作是调用合约Y（该操作的source_address是x），那么合约Y执行过程中，sender的值就是x账号的地址。</p>
</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">tx</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm">那么bar的值是x的账号地址。</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul>
<li><p>交易的星火令价格</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tx.gasPrice</span></code></p>
<p>交易签名里的星火令价格。</p>
</li>
<li><p>交易的哈希值</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tx.hash</span></code></p>
<p>交易的hash值</p>
</li>
<li><p>交易的限制费用</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.tx.feeLimit</span></code></p>
</li>
</ul>
</li>
<li><p>消息 Chain.msg</p>
<p>消息是在交易里触发智能合约执行产生的信息。在触发的合约执行的过程中，交易信息不会被改变，消息会发生变化。例如在合约中调用<code class="docutils literal notranslate"><span class="pre">contractCall</span></code>，<code class="docutils literal notranslate"><span class="pre">contractQuery</span></code>的时候，消息会变化。</p>
<ul>
<li><p>消息的发起者</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.msg.initiator</span></code></p>
<p>本消息的原始的发起者账号。</p>
</li>
<li><p>消息的触发者</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.msg.sender</span></code></p>
<p>本次消息的触发者账号。</p>
<p>例如某账号发起了一笔交易，该交易中有个操作是调用合约Y（该操作的source_address是x），那么合约Y执行过程中，sender的值就是x账号的地址。</p>
</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm">那么bar的值是x的账号地址。</span>
<span class="cm">*/</span>
</pre></div>
</div>
<ul>
<li><p>本次交易里的发起者的nonce值</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.msg.nonce</span></code>。即<code class="docutils literal notranslate"><span class="pre">Chain.msg.initiator</span></code>账号的 nonce值。</p>
</li>
<li><p>触发本次合约调用的操作的序号</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.msg.operationIndex</span></code></p>
<p>该值等于触发本次合约的操作的序号。</p>
<p>例如某账号A发起了一笔交易tx0，tx0中第0（从0开始计数）个操作是给某个合约账户转移星火令（调用合约），那么<code class="docutils literal notranslate"><span class="pre">Chain.msg.operationIndex</span></code>的值就是0。</p>
</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">Chain</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">operationIndex</span><span class="p">;</span>
<span class="cm">/* bar 是一个非负整数*/</span>
</pre></div>
</div>
</li>
<li><p>当前合约账号的地址</p>
<p><code class="docutils literal notranslate"><span class="pre">Chain.thisAddress</span></code></p>
<p>该值等于该合约账号的地址。</p>
<p>例如账号x发起了一笔交易调用合约Y，本次执行过程中，该值就是Y合约账号的地址。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>let bar = Chain.msg.thisAddress;
/*
bar的值是Y合约的账号地址。
*/
</pre></div>
</div>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>API</p></th>
<th class="head"><p>含义</p></th>
<th class="head"><p>用法</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>getBalance</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>storageStore</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>storageLoad</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>stroageDel</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>int64Add</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>int64Sub</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>int64Mul</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>int64Div</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>int64Mod</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>int64Compare</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>toBaseUnit</p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<ol class="arabic">
<li><p>异常处理</p>
<ul>
<li><p>主动抛出异常</p>
<p>星火链Javascript合约禁用了try catch关键字, 但是可以调用throw来抛出异常, 当执行遇到throw异常时, 该交易判定为失败, 入链扣费但是交易不生效.</p>
</li>
<li><p>JavaScript异常</p></li>
</ul>
<p>当合约运行中出现未捕获的JavaScript异常时，处理规定：</p>
<ul class="simple">
<li><p>本次合约执行失败，合约中做的所有交易都不会生效。</p></li>
<li><p>触发本次合约的这笔交易为失败。错误代码为<code class="docutils literal notranslate"><span class="pre">151</span></code>。</p></li>
</ul>
<ul>
<li><p>执行交易失败</p>
<p>合约中可以执行多个交易，只要有一个交易失败，就会抛出异常，导致整个交易失败</p>
</li>
</ul>
</li>
<li><p>javascript合约限制</p>
<p>由于区块链智能合约的执行机制原因, 星火链对javascript智能合约也做了如下的限制:</p>
<ul>
<li><p>堆大小限制: 30Mb</p></li>
<li><p>栈大小限制: 512Kb</p></li>
<li><p>执行计步限制: 10240</p></li>
<li><p>执行时间限制: 1s</p></li>
<li><p>合约字节限制: 256Kb</p></li>
<li><p>去除函数: Data, Random</p></li>
<li><p>禁用关键字:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;DataView&quot;</span><span class="p">,</span> <span class="s2">&quot;decodeURI&quot;</span><span class="p">,</span> <span class="s2">&quot;decodeURIComponent&quot;</span><span class="p">,</span> <span class="s2">&quot;encodeURI&quot;</span><span class="p">,</span> <span class="s2">&quot;encodeURIComponent&quot;</span><span class="p">,</span> <span class="s2">&quot;Generator&quot;</span><span class="p">,</span><span class="s2">&quot;GeneratorFunction&quot;</span><span class="p">,</span> <span class="s2">&quot;Intl&quot;</span><span class="p">,</span> <span class="s2">&quot;Promise&quot;</span><span class="p">,</span> <span class="s2">&quot;Proxy&quot;</span><span class="p">,</span> <span class="s2">&quot;Reflect&quot;</span><span class="p">,</span> <span class="s2">&quot;System&quot;</span><span class="p">,</span> <span class="s2">&quot;URIError&quot;</span><span class="p">,</span> <span class="s2">&quot;WeakMap&quot;</span><span class="p">,</span> <span class="s2">&quot;WeakSet&quot;</span><span class="p">,</span> <span class="s2">&quot;Math&quot;</span><span class="p">,</span> <span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="s2">&quot;eval&quot;</span><span class="p">,</span> <span class="s2">&quot;void&quot;</span><span class="p">,</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="s2">&quot;try&quot;</span><span class="p">,</span> <span class="s2">&quot;catch&quot;</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ol>
</section>
<section id="solidity">
<h3>Solidity合约开发<a class="headerlink" href="#solidity" title="Permalink to this headline"></a></h3>
<p>​
Solidity智能合约使用Spark-Evm引擎，脱胎于原生以太坊EVM架构实现。在星火链合约账户中，Solidity编译后生成的opCode指令码会存储到合约账户中，用于合约的执行。</p>
<p>本目录的文档主要介绍在星火链合约平台中支持的 Solidity 合约的特性、语法、功能等。星火链平台支持的solidity语法基本与官方solidity基本一致，目前支持0.4.26版本，可以参考官方文档: https://solidity.readthedocs.io/en/v0.4.26/</p>
<ol class="arabic">
<li><p>星火链Solidity与以太坊Solidity的区别</p>
<ul class="simple">
<li><p>星火链平台solidity对address关键字进行了重新开发，address表示的合约地址或账户地址，长度为24字节；而官方solidity中address表示的地址是20字节。</p></li>
<li><p>在星火链链平台上，如果尝试在合约内向一个不存在的地址转账，合约会异常终止；而在以太坊官方 Solidity 合约内向不存在的地址转账时，系统会自动以该地址创建账户。</p></li>
<li><p>星火链平台中，solidity不支持STATICCALL指令。</p></li>
<li><p>星火链平台中，solidity不支持CALLCODE指令。</p></li>
<li><p>星火链平台中，solidity不支持SELFDESTRUCT指令。</p></li>
<li><p>星火链平台中，合约账户无codehash，solidity不支持EXTCODEHASH指令。</p></li>
<li><p>星火链平台中，区块中未保存出块人信息，solidity不支持COINBASE指令。</p></li>
<li><p>星火链平台中，无难度值概念，solidity不支持DIFFICULT指令。</p></li>
<li><p>星火链平台中，自定义实现了STOI64CHECK指令。</p></li>
<li><p>星火链EVM引擎处理交易时，使用星火令消耗上限+异常退出（递归深度，栈，内存）+超时。需要指定当前交易接受的最大星火令，执行合约时，按照具体指令扣减星火令。当星火令不足时，合约执行结束。</p></li>
<li><p>当递归深度超过配置的最大深度时，合约执行结束。此处为兼容星火链框架，合约递归深度未使用以太坊原始最大递归深度1024，合约最大递归深度为4层。</p></li>
</ul>
</li>
<li><p>星火链EVM指令集比较</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>指令表</p></th>
<th class="head"><p>星火链是否支持</p></th>
<th class="head"><p>以太坊是否支持</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CREATE2</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>CREATE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>DELEGATECALL</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>STATICCALL</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CALL</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>CALLCODE</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>RETURN</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>REVERT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SELFDESTRUCT</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>STOP</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>MLOAD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>MSTORE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>MSTORE8</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SHA3</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>LOG0</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>LOG1</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>LOG2</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>LOG3</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>LOG4</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>EXP</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>ADD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>MUL</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SUB</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>DIV</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SDIV</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>MOD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SMOD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>NOT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>LT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>GT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SLT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SGT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>EQ</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>ISZERO</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>AND</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>OR</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>XOR</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>BYTE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SHL</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SHR</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SAR</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>ADDMOD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>MULMOD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SIGNEXTEND</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>ADDRESS</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>ORIGIN</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>BALANCE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>CALLER</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CALLVALUE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>CALLDATALOAD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CALLDATASIZE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>RETURNDATASIZE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CODESIZE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>EXTCODESIZE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CALLDATACOPY</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>RETURNDATACOPY</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>EXTCODEHASH</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>CODECOPY</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>EXTCODECOPY</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>GASPRICE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>BLOCKHASH</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>COINBASE</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>TIMESTAMP</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>NUMBER</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>DIFFICULTY</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>GASLIMIT</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>CHAINID</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SELFBALANCE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>POP</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>PUSHC</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>PUSH1/32</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>JUMP</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>JUMPI</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>JUMPC</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>JUMPCI</p></td>
<td><p>否</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>DUP1/16</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SWAP1/16</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>SLOAD</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>SSTORE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>PC</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>MSIZE</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>GAS</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>JUMPDEST</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>合约数据类型</p>
<p><strong>基本类型：</strong></p>
<p>uint&lt;M&gt;：M 位的无符号整数，0 &lt; M &lt;= 256、M % 8 == 0。例如：uint32，uint8，uint256。</p>
<p>int&lt;M&gt;：以 2 的补码作为符号的 M 位整数，0 &lt; M &lt;= 256、M % 8 == 0。</p>
<p>uint、int：uint256、int256 各自的同义词。在计算和 函数选择器 中，通常使用 uint256 和 int256。</p>
<p>bool：等价于 uint8，取值限定为 0 或 1 。在计算和 函数选择器 中，通常使用 bool。</p>
<p>bytes&lt;M&gt;：M 字节的二进制类型，0 &lt; M &lt;= 32。</p>
<p>byte：等价于bytes1。</p>
<p>bytes：动态大小的字节序列。</p>
<p>string：动态大小的 unicode 字符串，通常呈现为 UTF-8 编码。</p>
<p><strong>一维数组：</strong></p>
<p>type[M](type=uint/int/address) 有 M 个元素的定长数组，M &gt;= 0，数组元素为给定类型。</p>
<p><strong>二维数组：</strong></p>
<p>type[][](type=uint/int)</p>
<p><strong>平台建议使用数据类型</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>数据类型</p></th>
<th class="head"><p>参考样例</p></th>
<th class="head"><p>合约内部是否支持</p></th>
<th class="head"><p>输入参数是否支持</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bool</p></td>
<td><p>bool a = true</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>uint</p></td>
<td><p>uint a = 1</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>uint8 ~ uint256</p></td>
<td><p>uint8 a = 1</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>int</p></td>
<td><p>int a = 1</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>int8 ~ int256</p></td>
<td><p>int8 a = 1</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>bytes</p></td>
<td><p>bytes a = “test”</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>bytes1 ~ bytes32</p></td>
<td><p>bytes1 a = “a”</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>string</p></td>
<td><p>string a = “test”</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>int[]</p></td>
<td><p>int256[] a = [1,2,3,4,5]</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-odd"><td><p>uint[]</p></td>
<td><p>uint256[] a = [1,2,3,4,5]</p></td>
<td><p>是</p></td>
<td><p>是</p></td>
</tr>
<tr class="row-even"><td><p>bytes1[] ~ bytes32[]</p></td>
<td><p>bytes4[] asd = new bytes4;</p></td>
<td><p>是</p></td>
<td><p>否</p></td>
</tr>
<tr class="row-odd"><td><p>string[]</p></td>
<td><p>string[] a = [“adbc”,”dg”]</p></td>
<td><p>是</p></td>
<td><p>否</p></td>
</tr>
<tr class="row-even"><td><p>enum</p></td>
<td><p>enum a {a,b,c}</p></td>
<td><p>是</p></td>
<td><p>否</p></td>
</tr>
<tr class="row-odd"><td><p>struct</p></td>
<td><p>struct a { string name;}</p></td>
<td><p>是</p></td>
<td><p>否</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>Solidity合约编译</p>
<p>星火链合约平台支持 Solidity 智能合约，由于Spark-Evm中存在的特性，不能使用以太坊提供的编译器编译处理Solidity合约 ，因此我们提供了星火链Solidity的编译工具docker镜像。</p>
<ul>
<li><p>镜像下载</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker pull caictdevelop/bif-solidity:v0.4.26
</pre></div>
</div>
</li>
<li><p>使用solc</p>
<p>镜像下载之后，需要启动镜像进入容器中，可以使用solc –help 来查看此工具支持的参数说明。</p>
<p>常用选项说明：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--opcodes            Opcodes of the contracts.
--bin                Binary of the contracts <span class="k">in</span> hex.
--abi                ABI specification of the contracts.
</pre></div>
</div>
</li>
<li><p>编译合约</p>
<ul>
<li><p>启动镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># docker相关操作需要root权限</span>
docker run -it caictdevelop/bif-solidity:v0.4.26 /bin/bash
</pre></div>
</div>
</li>
<li><p>编写合约test.sol</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="k">pragma solidity</span><span class="w"> </span><span class="o">^</span><span class="k">0.4.26</span><span class="p">;</span><span class="w"></span>

<span class="k">contract</span><span class="w"> </span><span class="ni">test</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">testfun</span><span class="p">()</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span><span class="kt">returns</span><span class="p">(</span><span class="kt">string</span><span class="p">){</span><span class="w"></span>
<span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="s2">&quot;hello world&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>编译合约</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#cd /root/solidity/build/solc</span>
<span class="c1">#./solc --bin test.sol</span>

<span class="o">=======</span> test.sol:test <span class="o">=======</span>
Binary: 
608060405234801561001057600080fd5b5061013f806100206000396000f300608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063031153c214610046575b600080fd5b34801561005257600080fd5b5061005b6100d6565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561009b578082015181840152602081019050610080565b50505050905090810190601f1680156100c85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b60606040805190810160405280600b81526020017f68656c6c6f20776f726c640000000000000000000000000000000000000000008152509050905600a165627a7a723058201a4c9bfcbee5d683f6e46525cf17db2dd46a6ecf5c3f45cbdd148229639263480029
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
<li><p>solidity合约部署</p>
<p>使用星火solidity工具编译合约后, 使用Java SDK将合约部署到链上.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">contractCreate</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 初始化参数</span>
    <span class="n">String</span> <span class="n">senderAddress</span> <span class="o">=</span> <span class="s">&quot;did:bid:efuEAGFPJMsojwPGKzjD8vZX1wbaUrVV&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">senderPrivateKey</span> <span class="o">=</span> <span class="s">&quot;priSPKkAwBP7w1ajzwp16hNBHvz5psKsksmgZDapcaebzxCS42&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="s">&quot;608060405234801561001057600080fd5b50610444806...&quot;</span><span class="p">;</span>

    <span class="n">Long</span> <span class="n">initBalance</span> <span class="o">=</span> <span class="n">ToBaseUnit</span><span class="p">.</span><span class="na">ToUGas</span><span class="p">(</span><span class="s">&quot;0.01&quot;</span><span class="p">);</span>

    <span class="n">BIFContractCreateRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractCreateRequest</span><span class="p">();</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">senderAddress</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">senderPrivateKey</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setInitBalance</span><span class="p">(</span><span class="n">initBalance</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setPayload</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setMetadata</span><span class="p">(</span><span class="s">&quot;create contract&quot;</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setType</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="c1">// 调用BIFContractCreate接口</span>
    <span class="n">BIFContractCreateResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractCreate</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getResult</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;error:      &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>solidity合约调用</p>
<p>调用星火链Solidity合约时, 可以直接用命名字符串形式调用指定接口, 星火链会将的input编译成字节码然后调用solidity合约.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
    &quot;function&quot;:&quot;xxx&quot;,//待调用函数声明 入setKey(int256,string)，仅包含函数名（形参类型）
    &quot;args&quot;:{ 
        &quot;xxx&quot;:&quot;&quot;//待调用合约的参数，多个参数使用“，”分隔
    }
}
</pre></div>
</div>
<p>示例Java SDK代码如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">contractInvokeByGas</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 初始化参数</span>
    <span class="n">String</span> <span class="n">senderAddress</span> <span class="o">=</span> <span class="s">&quot;did:bid:efuEAGFPJMsojwPGKzjD8vZX1wbaUrVV&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">contractAddress</span> <span class="o">=</span> <span class="s">&quot;did:bid:efrVoaxEQo9sDqQmv9BCnDstyu1FDTHE&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">senderPrivateKey</span> <span class="o">=</span> <span class="s">&quot;priSPKkAwBP7w1ajzwp16hNBHvz5psKsksmgZDapcaebzxCS42&quot;</span><span class="p">;</span>
    <span class="n">Long</span> <span class="n">amount</span> <span class="o">=</span> <span class="mi">1000L</span><span class="p">;</span>

    <span class="n">BIFContractInvokeRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BIFContractInvokeRequest</span><span class="p">();</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setSenderAddress</span><span class="p">(</span><span class="n">senderAddress</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setPrivateKey</span><span class="p">(</span><span class="n">senderPrivateKey</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setContractAddress</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setBIFAmount</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setMetadata</span><span class="p">(</span><span class="s">&quot;contract invoke&quot;</span><span class="p">);</span>
    <span class="n">request</span><span class="p">.</span><span class="na">setInput</span><span class="p">(</span><span class="s">&quot;{\&quot;function\&quot;:\&quot;setKey(int256,string)\&quot;,\&quot;args\&quot;:\&quot;123,&#39;hello world&#39;\&quot;}&quot;</span><span class="p">);</span>
    <span class="c1">// 调用 BIFContractInvoke 接口</span>
    <span class="n">BIFContractInvokeResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">sdk</span><span class="p">.</span><span class="na">getBIFContractService</span><span class="p">().</span><span class="na">contractInvoke</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getErrorCode</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">JSON</span><span class="p">.</span><span class="na">toJSONString</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">getResult</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;error:      &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">.</span><span class="na">getErrorDesc</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, 中国信息通信研究院.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>