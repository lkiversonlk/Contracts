<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>星火链订阅服务 &mdash; 星火链开发者手册 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> 星火链开发者手册
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">星火链应用开发手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="%E6%A6%82%E8%BF%B0.html">概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B.html">快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html">星火链开发基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESDK.html">星火链SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BEJavascript%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Javascript合约开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BESolidity%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91.html">星火链Solidity合约开发</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%98%9F%E7%81%AB%E9%93%BE%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%8F%82%E8%80%83.html">星火链智能合约参考</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">星火链开发者手册</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>星火链订阅服务</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/星火链订阅服务.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>星火链订阅服务<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h1>
<p>​星火链网提供了对于链上区块和交易的订阅功能, 本章节会逐一演示如何接入订阅服务.</p>
<p>​<strong>github</strong>代码库地址：https://github.com/CAICT-DEV/bif-core-subscribe-tool</p>
<section id="id2">
<h2>环境要求<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<h2 id="min-content" style="display:none;"> </h2>
<p>​本节描述订阅服务环境要求。</p>
<ul class="simple">
<li><p>JDK1.8以上的版本。更多信息，请参见<a class="reference external" href="https://www.oracle.com/java/technologies/javase-downloads.html">安装JDK</a>。</p></li>
<li><p>安装Maven。更多信息，请参见<a class="reference external" href="https://maven.apache.org/download.cgi">安装Maven</a>。</p></li>
</ul>
</section>
<section id="id3">
<h2>方法说明<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<p>​</p>
<section id="addchainresponsemethod">
<h3>AddChainResponseMethod<a class="headerlink" href="#addchainresponsemethod" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>接口说明</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>该接口用于接收响应消息。
</pre></div>
</div>
<blockquote>
<div><p>调用方法</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BlockChainAdapter</span> <span class="nf">AddChainResponseMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_HELLO_VALUE</span><span class="p">,</span><span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{}});</span>
</pre></div>
</div>
<blockquote>
<div><p>请求参数</p>
</div></blockquote>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>序号</p></th>
<th class="head"><p>类型</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Overlay.ChainMessageType.CHAIN_HELLO_VALUE</p></td>
<td><p>hello数据类型</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>BlockChainAdapterProc(){}</p></td>
<td><p>定义消息处理方法</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>示例</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//接收hello响应消息</span>
<span class="n">BlockChainAdapter</span><span class="p">.</span><span class="na">AddChainResponseMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_HELLO_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainHello</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
</pre></div>
</div>
</section>
<section id="addchainmethod">
<h3>AddChainMethod<a class="headerlink" href="#addchainmethod" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>接口说明</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>该接口用于接收请求消息，请求消息是区块链实时推送的消息。
</pre></div>
</div>
<blockquote>
<div><p>调用方法</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BlockChainAdapter</span> <span class="nf">AddChainMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_TX_ENV_STORE_VALUE</span><span class="p">,,</span><span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{}});</span>
</pre></div>
</div>
<blockquote>
<div><p>请求参数</p>
</div></blockquote>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>序号</p></th>
<th class="head"><p>类型</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Overlay.ChainMessageType.CHAIN_TX_ENV_STORE_VALUE/CHAIN_LEDGER_TXS_VALUE</p></td>
<td><p>交易/区块数据类型</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>BlockChainAdapterProc(){}</p></td>
<td><p>定义消息处理方法</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>示例</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span> <span class="c1">//接收区块链实时推送的消息-交易信息</span>
        <span class="n">BlockChainAdapter</span><span class="p">.</span><span class="na">AddChainMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_TX_ENV_STORE_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainTxEnvStore</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

 <span class="c1">//接收区块链实时推送的消息-区块信息</span>
        <span class="n">BlockChainAdapter</span><span class="p">.</span><span class="na">AddChainMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_LEDGER_TXS_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainLedgerTxs</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
</pre></div>
</div>
</section>
<section id="send">
<h3>Send<a class="headerlink" href="#send" title="Permalink to this headline"></a></h3>
<blockquote>
<div><p>接口说明</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>该接口订阅指定账号交易信息。
</pre></div>
</div>
<blockquote>
<div><p>调用方法</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BlockChainAdapter</span> <span class="nf">Send</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_SUBSCRIBE_TX</span><span class="p">.</span><span class="na">getNumber</span><span class="p">(),</span> <span class="n">tx</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">()));</span>
</pre></div>
</div>
<blockquote>
<div><p>请求参数</p>
</div></blockquote>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>序号</p></th>
<th class="head"><p>类型</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Overlay.ChainMessageType.CHAIN_SUBSCRIBE_TX.getNumber()</p></td>
<td><p>交易/区块数据类型</p></td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>示例</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//订阅指定账号交易信息</span>
<span class="n">String</span> <span class="n">srcAddress</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="n">Overlay</span><span class="p">.</span><span class="na">ChainSubscribeTx</span><span class="p">.</span><span class="na">Builder</span> <span class="n">tx</span><span class="o">=</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainSubscribeTx</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">();</span>
  <span class="n">tx</span><span class="p">.</span><span class="na">addAddress</span><span class="p">(</span><span class="n">srcAddress</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">BlockChainAdapter</span><span class="p">.</span><span class="na">Send</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_SUBSCRIBE_TX</span><span class="p">.</span><span class="na">getNumber</span><span class="p">(),</span>  <span class="n">tx</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;send tx failed&quot;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id4">
<h2>订阅示例<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h2>
<p>​	该示例主要实现功能为订阅<strong>did:bid:efHmvWpqfVzv5rLNSMrhEdNegLz9AcnS</strong>账号交易信息。</p>
<blockquote>
<div><p>示例</p>
</div></blockquote>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">chain_test</span> <span class="n">chainTest</span><span class="p">;</span>
    <span class="cm">/**</span>
<span class="cm">     * BIF-Core-SDK</span>
<span class="cm">     */</span>
    <span class="n">String</span> <span class="n">httpUrl</span> <span class="o">=</span> <span class="s">&quot;http://172.19.6.22:37002&quot;</span><span class="p">;</span>
    <span class="n">BIFSDK</span> <span class="n">sdk</span> <span class="o">=</span> <span class="n">BIFSDK</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">httpUrl</span><span class="p">);</span>
    <span class="cm">/**</span>
<span class="cm">     * 订阅服务</span>
<span class="cm">     */</span>
    <span class="n">String</span> <span class="n">webSocketUrl</span> <span class="o">=</span> <span class="s">&quot;ws://172.19.6.22:810&quot;</span><span class="p">;</span>
    <span class="kt">boolean</span> <span class="n">isConnected</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="cm">/**</span>
<span class="cm">     * 订阅账号</span>
<span class="cm">     */</span>
    <span class="n">String</span> <span class="n">srcAddress</span> <span class="o">=</span> <span class="s">&quot;did:bid:efHmvWpqfVzv5rLNSMrhEdNegLz9AcnS&quot;</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">     * 消息适配器</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">BlockChainAdapter</span> <span class="n">chain_message_one_</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">chainTest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">chain_test</span><span class="p">();</span>
        <span class="n">chainTest</span><span class="p">.</span><span class="na">Initialize</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;*****************start chain_message successfully******************&quot;</span><span class="p">);</span>
        <span class="c1">//chainTest.Stop();</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Stop</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">chain_message_one_</span><span class="p">.</span><span class="na">Stop</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 订阅初始化</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">chain_message_one_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlockChainAdapter</span><span class="p">(</span><span class="n">webSocketUrl</span><span class="p">);</span>
        <span class="c1">//接收hello响应消息</span>
        <span class="n">chain_message_one_</span><span class="p">.</span><span class="na">AddChainResponseMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_HELLO_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainHello</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="c1">//接收区块链实时推送的消息-交易信息</span>
        <span class="n">chain_message_one_</span><span class="p">.</span><span class="na">AddChainMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_TX_ENV_STORE_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainTxEnvStore</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="c1">//接收区块链实时推送的消息-区块信息</span>
        <span class="n">chain_message_one_</span><span class="p">.</span><span class="na">AddChainMethod</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_LEDGER_TXS_VALUE</span><span class="p">,</span> <span class="k">new</span> <span class="n">BlockChainAdapterProc</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">ChainMethod</span> <span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">OnChainLedgerTxs</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="c1">//发送hello请求</span>
        <span class="n">Overlay</span><span class="p">.</span><span class="na">ChainHello</span><span class="p">.</span><span class="na">Builder</span> <span class="n">chain_hello</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">.</span><span class="na">ChainHello</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">();</span>
        <span class="n">chain_hello</span><span class="p">.</span><span class="na">setTimestamp</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chain_message_one_</span><span class="p">.</span><span class="na">Send</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_HELLO</span><span class="p">.</span><span class="na">getNumber</span><span class="p">(),</span> <span class="n">chain_hello</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;send hello failed&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//订阅指定账号交易信息</span>
        <span class="n">Overlay</span><span class="p">.</span><span class="na">ChainSubscribeTx</span><span class="p">.</span><span class="na">Builder</span> <span class="n">tx</span><span class="o">=</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainSubscribeTx</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">();</span>
        <span class="n">tx</span><span class="p">.</span><span class="na">addAddress</span><span class="p">(</span><span class="n">srcAddress</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chain_message_one_</span><span class="p">.</span><span class="na">Send</span><span class="p">(</span><span class="n">Overlay</span><span class="p">.</span><span class="na">ChainMessageType</span><span class="p">.</span><span class="na">CHAIN_SUBSCRIBE_TX</span><span class="p">.</span><span class="na">getNumber</span><span class="p">(),</span> <span class="n">tx</span><span class="p">.</span><span class="na">build</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">()))</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;send tx failed&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
     <span class="c1">//hello消息处理</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">OnChainHello</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Overlay</span><span class="p">.</span><span class="na">ChainStatus</span> <span class="n">chain_status</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">.</span><span class="na">ChainStatus</span><span class="p">.</span><span class="na">parseFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;chain_status &quot;</span><span class="o">+</span><span class="n">chain_status</span><span class="p">);</span>
            <span class="n">isConnected</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="c1">//交易消息处理</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">OnChainTxEnvStore</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Chain</span><span class="p">.</span><span class="na">TransactionEnvStore</span>  <span class="n">envStore</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">.</span><span class="na">TransactionEnvStore</span><span class="p">.</span><span class="na">parseFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;OnChainTxEnvStore hash:&quot;</span> <span class="o">+</span> <span class="n">ToHex</span><span class="p">.</span><span class="na">bytesToHex</span><span class="p">(</span><span class="n">envStore</span><span class="p">.</span><span class="na">getHash</span><span class="p">().</span><span class="na">toByteArray</span><span class="p">()));</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
   
   <span class="c1">//区块消息处理</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">OnChainLedgerTxs</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">Overlay</span><span class="p">.</span><span class="na">LedgerTxs</span> <span class="n">envStore</span> <span class="o">=</span> <span class="n">Overlay</span><span class="p">.</span><span class="na">LedgerTxs</span><span class="p">.</span><span class="na">parseFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;header size:&quot;</span> <span class="o">+</span> <span class="n">envStore</span><span class="p">.</span><span class="na">getLedgerLength</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, 中国信息通信研究院.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>